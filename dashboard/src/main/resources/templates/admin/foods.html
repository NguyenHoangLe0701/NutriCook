<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{admin/layout :: layout(~{::content}, 'M√≥n ƒÉn', 'Qu·∫£n l√Ω danh s√°ch m√≥n ƒÉn', 'foods')}">

<div th:fragment="content">

    <div class="sm:flex sm:items-center">
        <div class="sm:flex-auto">
            </div>
        <div class="mt-4 sm:mt-0 sm:ml-16 sm:flex-none">
            <button type="button" onclick="openModal('addFoodModal')" class="inline-flex items-center justify-center rounded-xl border border-transparent bg-gradient-to-r from-orange-500 to-amber-500 px-6 py-3 text-base font-bold text-white shadow-lg hover:from-orange-600 hover:to-amber-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 sm:w-auto transition-all duration-300 transform hover:-translate-y-1 hover:shadow-2xl">
                <i class="fas fa-plus mr-2"></i> Th√™m m√≥n ƒÉn
            </button>
        </div>
    </div>

    <div class="mt-8 flex flex-col">
        <div class="-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8">
            <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
                <div class="overflow-hidden shadow-lg ring-1 ring-orange-200 md:rounded-2xl bg-white">
                    <table class="min-w-full divide-y divide-orange-100">
                        <thead class="bg-gradient-to-r from-orange-50 to-amber-50 border-b border-orange-200">
                            <tr>
                                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-bold text-orange-900 sm:pl-6">M√≥n ƒÉn</th>
                                <th scope="col" class="px-3 py-3.5 text-left text-sm font-bold text-orange-900">Danh m·ª•c</th>
                                <th scope="col" class="px-3 py-3.5 text-left text-sm font-bold text-orange-900">Tr·∫°ng th√°i</th>
                                <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
                                    <span class="sr-only">H√†nh ƒë·ªông</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-orange-100 bg-white">
                            <tr th:each="food : ${foods}" class="hover:bg-orange-50 transition-colors duration-200">
                                <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm sm:pl-6">
                                    <div class="flex items-center">
                                        <div class="h-10 w-10 flex-shrink-0">
                                            <img class="h-10 w-10 rounded-md object-cover" 
                                                 th:src="${(food.imageUrl != null and !#strings.isEmpty(food.imageUrl)) ? food.imageUrl : '/images/default-food.svg'}" 
                                                 alt="·∫¢nh m√≥n ƒÉn"
                                                 onerror="this.onerror=null; this.src='/images/default-food.svg';">
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium text-gray-900" th:text="${food.name}">T√™n m√≥n ƒÉn</div>
                                            <div class="text-gray-500" th:text="${food.calories}">52 kcal</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                    <span th:text="${food.category?.name} ?: 'N/A'">Rau c·ªß</span>
                                </td>
                                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                    <span th:if="${food.available}" class="inline-flex rounded-full bg-green-100 px-2 text-xs font-semibold leading-5 text-green-800">C√≥ s·∫µn</span>
                                    <span th:unless="${food.available}" class="inline-flex rounded-full bg-red-100 px-2 text-xs font-semibold leading-5 text-red-800">H·∫øt h√†ng</span>
                                </td>
                                <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6 space-x-2">
                                    <form th:action="@{/admin/foods/{id}/toggle-availability(id=${food.id})}" method="POST" class="inline-block">
                                        <button type="submit" class="inline-flex items-center justify-center rounded-lg bg-gradient-to-r from-slate-500 to-slate-600 px-3 py-2 font-bold text-white shadow-md hover:from-slate-600 hover:to-slate-700 transition-all duration-300 transform hover:scale-110" th:title="${food.available} ? 'V√¥ hi·ªáu h√≥a' : 'K√≠ch ho·∫°t'">
                                            <i class="fa-solid h-4 w-4" th:classappend="${food.available} ? 'fa-eye-slash' : 'fa-eye'"></i>
                                            <span class="sr-only" th:text="${food.available} ? 'V√¥ hi·ªáu h√≥a' : 'K√≠ch ho·∫°t'"></span>
                                        </button>
                                    </form>

                                    <button type="button" 
                                            class="edit-food-btn inline-flex items-center justify-center rounded-lg bg-gradient-to-r from-emerald-500 to-cyan-600 px-3 py-2 font-bold text-white shadow-md hover:from-emerald-600 hover:to-cyan-700 transition-all duration-300 transform hover:scale-110" 
                                            title="S·ª≠a"
                                            th:data-id="${food.id}"
                                            th:data-name="${food.name}"
                                            th:data-category-id="${food.category?.id}"
                                            th:data-calories="${food.calories}"
                                            th:data-description="${food.description ?: ''}"
                                            th:data-unit="${food.unit ?: 'g'}">
                                        <i class="fa-solid fa-pen h-4 w-4"></i>
                                        <span class="sr-only" th:text="${', ' + food.name}"></span>
                                    </button>
                                    
                                    <form th:action="@{/admin/foods/{id}/delete(id=${food.id})}" method="post" class="inline-block" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a m√≥n ƒÉn n√†y?');">
                                        <button type="submit" class="inline-flex items-center justify-center rounded-lg bg-gradient-to-r from-rose-500 to-red-600 px-3 py-2 font-bold text-white shadow-md hover:from-rose-600 hover:to-red-700 transition-all duration-300 transform hover:scale-110" title="X√≥a">
                                            <i class="fa-solid fa-trash h-4 w-4"></i>
                                            <span class="sr-only" th:text="${', ' + food.name}"></span>
                                        </button>
                                    </form>
                                </td>
                            </tr>

                            <tr th:if="${#lists.isEmpty(foods)}">
                                <td colspan="4" class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 text-center">
                                    <div class="py-10">
                                        <i class="fa-solid fa-utensils fa-2x text-gray-400"></i>
                                        <h3 class="mt-2 text-sm font-medium text-gray-900">Ch∆∞a c√≥ m√≥n ƒÉn n√†o</h3>
                                        <p class="mt-1 text-sm text-gray-500">H√£y th√™m m√≥n ƒÉn m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu qu·∫£n l√Ω.</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="addFoodModal" class="relative z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-black/40 transition-opacity backdrop-blur-sm"></div>
        <div class="fixed inset-0 z-50 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-2xl bg-gradient-to-br from-white to-orange-50 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-5xl border border-orange-100">
                    <form th:action="@{/admin/foods}" th:object="${foodItem}" method="post" enctype="multipart/form-data">
                        <div class="bg-gradient-to-r from-orange-600 to-amber-600 px-6 pt-5 pb-3">
                            <h3 class="text-2xl font-bold text-white" id="modal-title">Th√™m m√≥n ƒÉn m·ªõi</h3>
                        </div>
                        <div class="px-6 pt-5 pb-5 sm:p-6">
                            <div class="max-w-2xl mx-auto">
                                <!-- Th√¥ng tin c∆° b·∫£n -->
                                <div class="space-y-5">
                                    <div class="bg-white/60 rounded-xl p-4 border border-orange-100">
                                        <h4 class="text-base font-bold text-orange-800 mb-4 flex items-center">
                                            <span class="mr-2">üìù</span> Th√¥ng tin c∆° b·∫£n
                                        </h4>
                                        <div class="space-y-4">
                                            <div>
                                                <label for="name" class="block text-sm font-semibold text-gray-700 mb-1.5">T√™n m√≥n ƒÉn *</label>
                                                <input type="text" th:field="*{name}" id="name" class="block w-full px-4 py-2.5 rounded-lg border-2 border-orange-200 bg-white shadow-sm focus:border-orange-500 focus:ring-2 focus:ring-orange-300 text-sm transition-all" required>
                                            </div>
                                            <div>
                                                <label for="category" class="block text-sm font-semibold text-gray-700 mb-1.5">Danh m·ª•c *</label>
                                                <select name="category.id" id="category" class="block w-full px-4 py-2.5 rounded-lg border-2 border-orange-200 bg-white shadow-sm focus:border-orange-500 focus:ring-2 focus:ring-orange-300 text-sm transition-all" required>
                                                    <option value="">-- Ch·ªçn danh m·ª•c --</option>
                                                    <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}">Rau c·ªß</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="unit" class="block text-sm font-semibold text-gray-700 mb-1.5">ƒê∆°n v·ªã m·∫∑c ƒë·ªãnh *</label>
                                                <select th:field="*{unit}" id="unit" class="block w-full px-4 py-2.5 rounded-lg border-2 border-orange-200 bg-white shadow-sm focus:border-orange-500 focus:ring-2 focus:ring-orange-300 text-sm transition-all" required>
                                                    <option value="g">g - Gram</option>
                                                    <option value="kg">kg - Kilogram</option>
                                                    <option value="ml">ml - Milliliter</option>
                                                    <option value="l">l - Liter</option>
                                                    <option value="qu·∫£">qu·∫£ - Qu·∫£/C√°i</option>
                                                    <option value="c·ªëc">c·ªëc - C·ªëc</option>
                                                    <option value="th√¨a canh">th√¨a canh - Th√¨a canh</option>
                                                    <option value="th√¨a c√† ph√™">th√¨a c√† ph√™ - Th√¨a c√† ph√™</option>
                                                    <option value="l√°t">l√°t - L√°t</option>
                                                    <option value="t√©p">t√©p - T√©p</option>
                                                </select>
                                                <p class="mt-1 text-xs text-gray-500">ƒê∆°n v·ªã ƒëo l∆∞·ªùng m·∫∑c ƒë·ªãnh cho nguy√™n li·ªáu n√†y</p>
                                            </div>
                                            <div>
                                                <label for="calories" class="block text-sm font-semibold text-gray-700 mb-1.5">Calories *</label>
                                                <div class="relative">
                                                    <input type="number" id="calories" step="0.1" min="0" class="block w-full px-4 py-2.5 pr-16 rounded-lg border-2 border-orange-200 bg-white shadow-sm focus:border-orange-500 focus:ring-2 focus:ring-orange-300 text-sm transition-all" placeholder="52" required onchange="updateCaloriesValue()">
                                                    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-sm font-medium text-gray-500">kcal</span>
                                                    <input type="hidden" th:field="*{calories}" id="calories-hidden">
                                                </div>
                                                <p class="mt-1 text-xs text-gray-500">Ch·ªâ c·∫ßn nh·∫≠p s·ªë, h·ªá th·ªëng t·ª± ƒë·ªông th√™m ƒë∆°n v·ªã kcal</p>
                                            </div>
                                            <div>
                                                <label for="description" class="block text-sm font-semibold text-gray-700 mb-1.5">M√¥ t·∫£</label>
                                                <textarea th:field="*{description}" id="description" rows="4" class="block w-full px-4 py-2.5 rounded-lg border-2 border-orange-200 bg-white shadow-sm focus:border-orange-500 focus:ring-2 focus:ring-orange-300 text-sm transition-all resize-none"></textarea>
                                            </div>
                                            <div>
                                                <label for="imageFile" class="block text-sm font-semibold text-gray-700 mb-1.5">H√¨nh ·∫£nh</label>
                                                <input type="file" name="imageFile" id="imageFile" accept="image/*" class="block w-full px-4 py-2.5 rounded-lg border-2 border-orange-200 bg-white shadow-sm text-gray-700 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-500 file:text-white hover:file:bg-orange-600 transition-all">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-orange-50 to-amber-50 px-6 py-4 sm:flex sm:flex-row-reverse sm:gap-3 border-t border-orange-200">
                            <button type="submit" class="inline-flex w-full justify-center items-center rounded-xl border border-transparent bg-gradient-to-r from-orange-500 via-amber-500 to-red-500 px-8 py-3 text-base font-bold text-white shadow-lg hover:from-orange-600 hover:via-amber-600 hover:to-red-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-all duration-300 transform hover:scale-105 hover:shadow-xl sm:w-auto">
                                <span class="mr-2">‚úì</span> Th√™m
                            </button>
                            <button type="button" onclick="closeModal('addFoodModal')" class="mt-3 inline-flex w-full justify-center items-center rounded-xl border-2 border-orange-300 bg-white px-8 py-3 text-base font-bold text-orange-700 shadow-md hover:bg-orange-50 hover:border-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-offset-2 transition-all duration-300 sm:mt-0 sm:w-auto">
                                <span class="mr-2">‚úï</span> H·ªßy
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Food Modal -->
    <div id="editFoodModal" class="relative z-50 hidden" aria-labelledby="edit-modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-black/40 transition-opacity backdrop-blur-sm"></div>
        <div class="fixed inset-0 z-50 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-2xl bg-gradient-to-br from-white to-orange-50 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-5xl border border-orange-100">
                    <form id="editFoodForm" method="post" enctype="multipart/form-data">
                        <div class="bg-gradient-to-r from-orange-600 to-amber-600 px-6 pt-5 pb-3">
                            <h3 class="text-2xl font-bold text-white" id="edit-modal-title">Ch·ªânh s·ª≠a m√≥n ƒÉn</h3>
                        </div>
                        <div class="px-6 pt-5 pb-5 sm:p-6">
                            <div class="max-w-2xl mx-auto">
                                <!-- Th√¥ng tin c∆° b·∫£n -->
                                <div class="space-y-5">
                                    <div class="bg-white/60 rounded-xl p-4 border border-orange-100">
                                        <h4 class="text-base font-bold text-orange-800 mb-4 flex items-center">
                                            <span class="mr-2">üìù</span> Th√¥ng tin c∆° b·∫£n
                                        </h4>
                                        <div class="space-y-4">
                                            <div>
                                                <label for="edit-name" class="block text-sm font-semibold text-gray-700 mb-1.5">T√™n m√≥n ƒÉn *</label>
                                                <input type="text" id="edit-name" name="name" class="block w-full px-4 py-2.5 rounded-lg border-2 border-orange-200 bg-white shadow-sm focus:border-orange-500 focus:ring-2 focus:ring-orange-300 text-sm transition-all" required>
                                            </div>
                                            <div>
                                                <label for="edit-category" class="block text-sm font-semibold text-gray-700 mb-1.5">Danh m·ª•c *</label>
                                                <select id="edit-category" name="category.id" class="block w-full px-4 py-2.5 rounded-lg border-2 border-orange-200 bg-white shadow-sm focus:border-orange-500 focus:ring-2 focus:ring-orange-300 text-sm transition-all" required>
                                                    <option value="">-- Ch·ªçn danh m·ª•c --</option>
                                                    <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.icon + ' ' + cat.name}"></option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="edit-unit" class="block text-sm font-semibold text-gray-700 mb-1.5">ƒê∆°n v·ªã m·∫∑c ƒë·ªãnh *</label>
                                                <select id="edit-unit" name="unit" class="block w-full px-4 py-2.5 rounded-lg border-2 border-orange-200 bg-white shadow-sm focus:border-orange-500 focus:ring-2 focus:ring-orange-300 text-sm transition-all" required>
                                                    <option value="g">g - Gram</option>
                                                    <option value="kg">kg - Kilogram</option>
                                                    <option value="ml">ml - Milliliter</option>
                                                    <option value="l">l - Liter</option>
                                                    <option value="qu·∫£">qu·∫£ - Qu·∫£/C√°i</option>
                                                    <option value="c·ªëc">c·ªëc - C·ªëc</option>
                                                    <option value="th√¨a canh">th√¨a canh - Th√¨a canh</option>
                                                    <option value="th√¨a c√† ph√™">th√¨a c√† ph√™ - Th√¨a c√† ph√™</option>
                                                    <option value="l√°t">l√°t - L√°t</option>
                                                    <option value="t√©p">t√©p - T√©p</option>
                                                </select>
                                                <p class="mt-1 text-xs text-gray-500">ƒê∆°n v·ªã ƒëo l∆∞·ªùng m·∫∑c ƒë·ªãnh cho nguy√™n li·ªáu n√†y</p>
                                            </div>
                                            <div>
                                                <label for="edit-calories" class="block text-sm font-semibold text-gray-700 mb-1.5">Calories *</label>
                                                <div class="relative">
                                                    <input type="number" id="edit-calories-input" step="0.1" min="0" class="block w-full px-4 py-2.5 pr-16 rounded-lg border-2 border-orange-200 bg-white shadow-sm focus:border-orange-500 focus:ring-2 focus:ring-orange-300 text-sm transition-all" placeholder="52" required>
                                                    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-sm font-medium text-gray-500">kcal</span>
                                                    <input type="hidden" id="edit-calories" name="calories">
                                                </div>
                                                <p class="mt-1 text-xs text-gray-500">Ch·ªâ c·∫ßn nh·∫≠p s·ªë, h·ªá th·ªëng t·ª± ƒë·ªông th√™m ƒë∆°n v·ªã kcal</p>
                                            </div>
                                            <div>
                                                <label for="edit-description" class="block text-sm font-semibold text-gray-700 mb-1.5">M√¥ t·∫£</label>
                                                <textarea id="edit-description" name="description" rows="4" class="block w-full px-4 py-2.5 rounded-lg border-2 border-orange-200 bg-white shadow-sm focus:border-orange-500 focus:ring-2 focus:ring-orange-300 text-sm transition-all resize-none"></textarea>
                                            </div>
                                            <div>
                                                <label for="edit-imageFile" class="block text-sm font-semibold text-gray-700 mb-1.5">H√¨nh ·∫£nh</label>
                                                <input type="file" name="imageFile" id="edit-imageFile" accept="image/*" class="block w-full px-4 py-2.5 rounded-lg border-2 border-orange-200 bg-white shadow-sm text-gray-700 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-500 file:text-white hover:file:bg-orange-600 transition-all">
                                                <p class="mt-1.5 text-xs text-gray-500">ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng mu·ªën thay ƒë·ªïi h√¨nh ·∫£nh</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-orange-50 to-amber-50 px-6 py-4 sm:flex sm:flex-row-reverse sm:gap-3 border-t border-orange-200">
                            <button type="submit" class="inline-flex w-full justify-center items-center rounded-xl border border-transparent bg-gradient-to-r from-orange-500 via-amber-500 to-red-500 px-8 py-3 text-base font-bold text-white shadow-lg hover:from-orange-600 hover:via-amber-600 hover:to-red-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-all duration-300 transform hover:scale-105 hover:shadow-xl sm:w-auto">
                                <span class="mr-2">‚úì</span> L∆∞u thay ƒë·ªïi
                            </button>
                            <button type="button" onclick="closeModal('editFoodModal')" class="mt-3 inline-flex w-full justify-center items-center rounded-xl border-2 border-orange-300 bg-white px-8 py-3 text-base font-bold text-orange-700 shadow-md hover:bg-orange-50 hover:border-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-offset-2 transition-all duration-300 sm:mt-0 sm:w-auto">
                                <span class="mr-2">‚úï</span> H·ªßy
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }
        
        function updateCaloriesValue() {
            const input = document.getElementById('calories');
            const hidden = document.getElementById('calories-hidden');
            if (input && hidden && input.value) {
                hidden.value = input.value + ' kcal';
            }
        }
        
        // Update calories when form is submitted
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form[th\\:action="@{/admin/foods}"]');
            if (form) {
                form.addEventListener('submit', function(e) {
                    updateCaloriesValue();
                });
            }
        });
        
        // Handle edit button clicks
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.edit-food-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const name = this.getAttribute('data-name') || '';
                    const categoryId = this.getAttribute('data-category-id') || '';
                    const calories = this.getAttribute('data-calories') || '';
                    const description = this.getAttribute('data-description') || '';
                    const unit = this.getAttribute('data-unit') || 'g';
                    
                    // Set form action
                    document.getElementById('editFoodForm').action = '/admin/foods/' + id + '/edit';
                    
                    // Fill form fields
                    document.getElementById('edit-name').value = name;
                    document.getElementById('edit-category').value = categoryId;
                    document.getElementById('edit-unit').value = unit;
                    
                    // Extract number from calories (e.g., "52 kcal" -> "52")
                    const caloriesNumber = calories.replace(/\s*kcal\s*/i, '').trim();
                    document.getElementById('edit-calories-input').value = caloriesNumber;
                    document.getElementById('edit-calories').value = calories;
                    
                    document.getElementById('edit-description').value = description;
                    
                    // Open modal
                    openModal('editFoodModal');
                });
            });
            
            // Update edit form calories on input change
            const editCaloriesInput = document.getElementById('edit-calories-input');
            if (editCaloriesInput) {
                editCaloriesInput.addEventListener('input', function() {
                    const hidden = document.getElementById('edit-calories');
                    if (hidden && this.value) {
                        hidden.value = this.value + ' kcal';
                    }
                });
            }
            
            // Update edit form calories on submit
            const editForm = document.getElementById('editFoodForm');
            if (editForm) {
                editForm.addEventListener('submit', function(e) {
                    const input = document.getElementById('edit-calories-input');
                    const hidden = document.getElementById('edit-calories');
                    if (input && hidden && input.value) {
                        hidden.value = input.value + ' kcal';
                    }
                });
            }
        });
    </script>
    </div>
</html>